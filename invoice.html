<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice Report</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.23.6/docxtemplater.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    header, footer {
      position: fixed;
      left: 0;
      right: 0;
      background-color: #f4f4f4;
      text-align: center;
      padding: 10px 0;
    }

    header {
      top: 0;
      border-bottom: 1px solid #ddd;
      z-index: 10;
    }

    footer {
      bottom: 0;
      border-top: 1px solid #ddd;
      z-index: 10;
    }

    .container {
      margin: 120px 20px 60px;
    }

    .invoice-section {
      margin-bottom: 40px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    table, th, td {
      border: 1px solid #ddd;
    }

    th, td {
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f9f9f9;
    }

    .export-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }

    select {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .export-button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      background-color: #007BFF;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }

    .export-button:hover {
      background-color: #0056b3;
    }

    .invoice-header {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <h2>Company Name</h2>
    <p>Invoice Report</p>
  </header>

  <footer>
    <p>&copy; 2025 Company Name</p>
  </footer>

  <div class="export-controls">
    <select id="exportOptions">
      <option value="pdf">Export to PDF</option>
      <option value="excel">Export to Excel</option>
      <option value="jpg">Export All to JPG</option>
      <option value="dom">Export as DOM</option>
      <option value="word">Export to Word</option>
    </select>
    <button class="export-button" onclick="handleExport()">Export</button>
  </div>

  <div class="container" id="invoice-container">
    <!-- Dynamic invoices will be inserted here -->
  </div>

  <script>
    const invoices = [
      {
        number: "12345",
        date: "2025-01-20",
        customer: "John Doe",
        items: Array.from({ length: 10 }, (_, i) => ({
          name: `Product ${i + 1}`,
          description: `Description for Product ${i + 1}`,
          quantity: Math.ceil(Math.random() * 10),
          price: (Math.random() * 100).toFixed(2),
        })),
      },
      {
        number: "67890",
        date: "2025-01-21",
        customer: "Jane Smith",
        items: Array.from({ length: 15 }, (_, i) => ({
          name: `Product ${i + 1}`,
          description: `Description for Product ${i + 1}`,
          quantity: Math.ceil(Math.random() * 10),
          price: (Math.random() * 100).toFixed(2),
        })),
      },
      {
        number: "11223",
        date: "2025-01-22",
        customer: "Alice Brown",
        items: Array.from({ length: 5 }, (_, i) => ({
          name: `Product ${i + 1}`,
          description: `Description for Product ${i + 1}`,
          quantity: Math.ceil(Math.random() * 10),
          price: (Math.random() * 100).toFixed(2),
        })),
      },
    ];

    const container = document.getElementById("invoice-container");

    invoices.forEach(invoice => {
      const invoiceSection = document.createElement("div");
      invoiceSection.classList.add("invoice-section");

      let grandTotal = 0;
      const itemsRows = invoice.items.map((item, index) => {
        const total = item.quantity * parseFloat(item.price);
        grandTotal += total;
        return `
          <tr>
            <td>${index + 1}</td>
            <td>${item.name}</td>
            <td>${item.description}</td>
            <td>${item.quantity}</td>
            <td>$${parseFloat(item.price).toFixed(2)}</td>
            <td>$${total.toFixed(2)}</td>
          </tr>
        `;
      }).join("");

      invoiceSection.innerHTML = `
        <div class="invoice-header">
          <h1>Invoice #${invoice.number}</h1>
          <p>Date: ${invoice.date}</p>
          <p>Customer: ${invoice.customer}</p>
        </div>
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Item Name</th>
              <th>Description</th>
              <th>Quantity</th>
              <th>Price</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            ${itemsRows}
          </tbody>
          <tfoot>
            <tr>
              <td colspan="5" style="text-align: right;"><strong>Grand Total:</strong></td>
              <td>$${grandTotal.toFixed(2)}</td>
            </tr>
          </tfoot>
        </table>
      `;

      container.appendChild(invoiceSection);
    });

    function handleExport() {
      const selectedOption = document.getElementById("exportOptions").value;

      if (selectedOption === "pdf") {
        exportToPdf();
      } else if (selectedOption === "excel") {
        exportToExcel();
      } else if (selectedOption === "jpg") {
        exportToJpg();
      } else if (selectedOption === "dom") {
        exportToDom();
      } else if (selectedOption === "word") {
        exportToWord();
      }
    }

    async function exportToPdf() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF('p', 'mm', 'a4');
  const container = document.getElementById("invoice-container");
  const canvas = await html2canvas(container, { scale: 2 });
  const imgData = canvas.toDataURL("image/png");
  const pdfWidth = pdf.internal.pageSize.getWidth();
  const pdfHeight = (canvas.height * pdfWidth) / canvas.width;

  // Add header
  pdf.setFontSize(18);
  pdf.text("Company Name", pdfWidth / 2, 10, { align: "center" });
  pdf.setFontSize(14);
  pdf.text("Invoice Report", pdfWidth / 2, 20, { align: "center" });

  // Add main content below the header
  const contentStartY = 30; // Start position for the content after header
  pdf.addImage(imgData, "PNG", 0, contentStartY, pdfWidth, pdfHeight);

  // Add footer
  const pageHeight = pdf.internal.pageSize.getHeight();
  pdf.setFontSize(10);
  pdf.text("© 2025 Company Name", pdfWidth / 2, pageHeight - 10, { align: "center" });

  // Save the file
  pdf.save("invoice-report.pdf");
}


async function exportToExcel() {
  const workbook = new ExcelJS.Workbook();
  const worksheet = workbook.addWorksheet("Invoices");

  // Add a styled header row
  worksheet.mergeCells("A1:H1");
  worksheet.getCell("A1").value = "Company Name";
  worksheet.getCell("A1").alignment = { horizontal: "center", vertical: "middle" };
  worksheet.getCell("A1").font = { bold: true, size: 16 };

  worksheet.mergeCells("A2:H2");
  worksheet.getCell("A2").value = "Invoice Report";
  worksheet.getCell("A2").alignment = { horizontal: "center", vertical: "middle" };
  worksheet.getCell("A2").font = { bold: true, size: 14 };

  worksheet.addRow([]);

  // Define table columns
  worksheet.columns = [
    { header: "Invoice Number", key: "number", width: 15 },
    { header: "Date", key: "date", width: 15 },
    { header: "Customer", key: "customer", width: 25 },
    { header: "Item Name", key: "item", width: 20 },
    { header: "Description", key: "description", width: 30 },
    { header: "Quantity", key: "quantity", width: 10 },
    { header: "Price", key: "price", width: 10 },
    { header: "Total", key: "total", width: 10 },
  ];

  // Add invoice data rows
  invoices.forEach((invoice) => {
    invoice.items.forEach((item) => {
      worksheet.addRow({
        number: invoice.number,
        date: invoice.date,
        customer: invoice.customer,
        item: item.name,
        description: item.description,
        quantity: item.quantity,
        price: item.price,
        total: (item.quantity * item.price).toFixed(2),
      });
    });
  });

  // Add a footer row
  const footerRow = worksheet.addRow([]);
  footerRow.getCell(1).value = "© 2025 Company Name";
  footerRow.getCell(1).alignment = { horizontal: "center", vertical: "middle" };
  footerRow.font = { italic: true };
  worksheet.mergeCells(`A${footerRow.number}:H${footerRow.number}`);

  // Apply border styles to the header row
  worksheet.eachRow({ includeEmpty: false }, (row, rowNumber) => {
    if (rowNumber === 3) {
      row.eachCell((cell) => {
        cell.border = {
          top: { style: "thin" },
          left: { style: "thin" },
          bottom: { style: "thin" },
          right: { style: "thin" },
        };
        cell.font = { bold: true };
        cell.alignment = { horizontal: "center" };
      });
    }
  });

  // Export the workbook
  const buffer = await workbook.xlsx.writeBuffer();
  const blob = new Blob([buffer], {
    type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
  });

  // Trigger download
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "invoice-report.xlsx";
  link.click();
}

async function exportToJpg() {
  const container = document.getElementById("invoice-container");

  // Create a temporary container with the header, content, and footer
  const tempContainer = document.createElement("div");
  tempContainer.style.padding = "20px";
  tempContainer.style.backgroundColor = "white";

  // Add header
  const header = document.createElement("div");
  header.style.textAlign = "center";
  header.style.marginBottom = "20px";
  header.innerHTML = `
    <h1 style="margin: 0; font-size: 24px;">Company Name</h1>
    <h2 style="margin: 0; font-size: 18px;">Invoice Report</h2>
  `;
  tempContainer.appendChild(header);

  // Clone the content and add it to the temporary container
  const contentClone = container.cloneNode(true);
  tempContainer.appendChild(contentClone);

  // Add footer
  const footer = document.createElement("div");
  footer.style.textAlign = "center";
  footer.style.marginTop = "20px";
  footer.style.fontStyle = "italic";
  footer.innerHTML = `
    <p style="margin: 0;">&copy; 2025 Company Name</p>
  `;
  tempContainer.appendChild(footer);

  // Append the temporary container to the body to render it
  document.body.appendChild(tempContainer);

  // Generate the image using html2canvas
  const canvas = await html2canvas(tempContainer, { scale: 2 });
  const imgData = canvas.toDataURL("image/jpeg", 1.0);

  // Trigger download
  const link = document.createElement("a");
  link.href = imgData;
  link.download = "invoice-report.jpg";
  link.click();

  // Clean up the temporary container
  document.body.removeChild(tempContainer);
}


function exportToDom() {
  // Create a temporary container to hold the full structure
  const tempContainer = document.createElement("div");
  tempContainer.style.backgroundColor = "white";

  // Add header
  const header = document.createElement("header");
  header.style.textAlign = "center";
  header.style.marginBottom = "20px";
  header.style.padding = "10px 0";
  header.style.backgroundColor = "#f4f4f4";
  header.style.borderBottom = "1px solid #ddd";
  header.innerHTML = `
    <h1 style="margin: 0; font-size: 24px;">Company Name</h1>
    <h2 style="margin: 0; font-size: 18px;">Invoice Report</h2>
  `;
  tempContainer.appendChild(header);

  // Clone the content and add it to the temporary container
  const container = document.getElementById("invoice-container");
  const contentClone = container.cloneNode(true);
  tempContainer.appendChild(contentClone);

  // Add footer
  const footer = document.createElement("footer");
  footer.style.textAlign = "center";
  footer.style.marginTop = "20px";
  footer.style.padding = "10px 0";
  footer.style.backgroundColor = "#f4f4f4";
  footer.style.borderTop = "1px solid #ddd";
  footer.innerHTML = `
    <p style="margin: 0;">&copy; 2025 Company Name</p>
  `;
  tempContainer.appendChild(footer);

  // Serialize the temporary container into an HTML string
  const domContent = tempContainer.outerHTML;

  // Create a Blob and trigger download
  const blob = new Blob([domContent], { type: "text/html" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "invoice-report.html";
  link.click();
}


    function exportToWord() {
      const header = `
    <header style="text-align: center; margin-bottom: 20px;">
      <h1>Company Name</h1>
      <h2>Invoice Report</h2>
    </header>
  `;
  const footer = `
    <footer style="text-align: center; margin-top: 20px;">
      <p>&copy; 2025 Company Name</p>
    </footer>
  `;
      const content = `<h1>Company Name</h1><h2>Invoice Report</h2>` + document.getElementById("invoice-container").outerHTML;
      const blob = new Blob(["\ufeff", content, footer], { type: "application/msword" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = "invoice-report.doc";
      link.click();
    }

  </script>
</body>
</html>
